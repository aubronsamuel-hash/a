# Application

APP_NAME=Coulisses Crew API
APP_ENV=dev
APP_HOST=0.0.0.0
APP_PORT=8001
APP_LOG_LEVEL=info
APP_DEFAULT_PAGE_SIZE=50
APP_MAX_PAGE_SIZE=200
APP_REQUEST_TIMEOUT_SECONDS=15

# Security

JWT_SECRET=changeme-dev
JWT_ALGO=HS256
JWT_TTL_SECONDS=3600
REFRESH_JWT_SECRET=changeme-refresh-dev
REFRESH_JWT_TTL_SECONDS=1209600

# === CORS ===

# Activer/desactiver CORS global
CORS_ENABLE=true

# Liste d'origines separees par des virgules (ex: http://localhost:5173,https://app.example.com)
CORS_ALLOW_ORIGINS=http://localhost:5173

# Liste methodes (GET,POST,PUT,PATCH,DELETE,OPTIONS,HEAD)
CORS_ALLOW_METHODS=GET,POST,PUT,PATCH,DELETE,OPTIONS,HEAD

# Liste headers autorises (ex: Authorization,Content-Type,If-None-Match)
CORS_ALLOW_HEADERS=Authorization,Content-Type,If-None-Match,If-Match

# Autoriser cookies/Authorization sur CORS
CORS_ALLOW_CREDENTIALS=false

# Cache preflight (secondes)
CORS_MAX_AGE=600

# Admin autoseed

ADMIN_AUTOSEED=true
ADMIN_USERNAME=admin
ADMIN_PASSWORD=admin123

# DB (par defaut SQLite)

DB_DSN=sqlite:///./cc.db
DB_POOL_SIZE=10
DB_MAX_OVERFLOW=20
DB_POOL_TIMEOUT=10

# Exemple Postgres local (compose): decommenter pour utiliser Postgres

# DB_DSN=postgresql+psycopg://cc:cc@localhost:5432/ccdb

# Observabilite

REQUEST_ID_HEADER=X-Request-ID
LOG_JSON=true

# Prometheus metrics
METRICS_ENABLED=1
METRICS_PATH=/metrics

# Features (comma-separated; inconnues ignorees)

FEATURES_ENABLED="observability,rate-limit,openapi-export"

# Rate limiting
RATE_LIMIT_ENABLE=true
RATE_LIMIT_GLOBAL_MAX=120
RATE_LIMIT_GLOBAL_WINDOW_SECONDS=60
RATE_LIMIT_AUTH_MAX=10
RATE_LIMIT_AUTH_WINDOW_SECONDS=60
RATE_LIMIT_BACKEND=memory
REDIS_URL=redis://localhost:6379/0

# Frontend (SPA)

FRONT_DIST_DIR=

# Operations

MAINTENANCE_MODE=false
MAINTENANCE_RETRY_AFTER_SECONDS=120
READ_ONLY_MODE=false

# Audit

AUDIT_LOG_PATH=audit.jsonl

# Readiness

READINESS_DB_TIMEOUT_SECONDS=2
READINESS_REQUIRE_REDIS=false

# Health endpoints: pas de config specifique ici, relies a DB
# Security Headers

SEC_HEADERS_ENABLE=true
CSP_DEFAULT_SRC='self'
CSP_SCRIPT_SRC='self'
CSP_STYLE_SRC='self'
CSP_IMG_SRC='self data:'
CSP_FONT_SRC='self data:'
CSP_CONNECT_SRC='self'
CSP_FRAME_SRC='none'

# Ajouter 'unsafe-inline' SEULEMENT si necessaire en dev; preferer nonce

CSP_ALLOW_UNSAFE_INLINE=false

# HSTS

HSTS_ENABLE=false
HSTS_MAX_AGE=15552000
HSTS_INCLUDE_SUBDOMAINS=true
HSTS_PRELOAD=false

# Referrer-Policy

REFERRER_POLICY='strict-origin-when-cross-origin'

# X-Frame-Options

X_FRAME_OPTIONS='DENY'

# Permissions-Policy (exemple minimal)

PERMISSIONS_POLICY="geolocation=(), microphone=(), camera=()"

# CDN
CDN_URL=http://localhost

# Gunicorn scaling
WEB_CONCURRENCY=
THREADS=1
GUNICORN_TIMEOUT=30
GUNICORN_GRACEFUL_TIMEOUT=30
GUNICORN_KEEPALIVE=5
GUNICORN_MAX_REQUESTS=500
GUNICORN_MAX_REQUESTS_JITTER=50

# OAuth Google
GOOGLE_CLIENT_ID=
GOOGLE_CLIENT_SECRET=
GOOGLE_REDIRECT_URI=http://localhost/auth/google/callback
GOOGLE_SCOPES=openid,email,profile
OAUTH_GOOGLE_TEST_MODE=1
STATE_SECRET=

# JWT (app)
JWT_SECRET=change_me
JWT_ALGO=HS256
JWT_EXPIRE_MINUTES=60

# DB (utilisees par les scripts de backup)
DB_HOST=localhost
DB_PORT=5432
DB_NAME=app_db
DB_USER=app_user
DB_PASSWORD=

# Backups
BACKUP_DIR=backups/db
BACKUP_RETENTION_DAYS=7

# Logs app (rotation fichier, sinon stdout)
LOG_TO_FILE=0
LOG_FILE_PATH=logs/app.log
LOG_FILE_MAX_BYTES=10485760
LOG_FILE_BACKUP_COUNT=5
LOG_LEVEL=INFO
